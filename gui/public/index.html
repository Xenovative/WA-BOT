<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <meta name="theme-color" content="#ffffff">
    <title data-i18n-title-page="dashboard.title">WhatsXENO Management Console</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <!-- QR Code Generator -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script></script>
    <!-- Internationalization -->
    <script src="/js/i18n.js"></script>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/chat.css">
    <!-- Admin Mode CSS -->
    <style>
        .admin-only { display: none; }
        .admin-mode .admin-only { display: block; }
        .admin-mode .non-admin-only { display: none; }
        
        /* Language selector styling */
        .language-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .language-selector select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 0.8rem;
        }
        
        .language-selector select option {
            background: #343a40;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <!-- Language Selector -->
                    <div class="language-selector">
                        <select id="language-selector" class="form-select form-select-sm">
                            <option value="en">English</option>
                            <option value="zh-TW">繁體中文</option>
                            <option value="zh-CN">简体中文</option>
                        </select>
                    </div>
                    
                    <div class="text-center mb-4">
                        <img src="/assets/whatsxeno.png" alt="WhatsXENO Logo" class="img-fluid mb-3" style="max-height: 80px; width: auto;">
                        <h3 class="text-light mb-0">WhatsXENO</h3>
                        <div id="connection-status" class="badge bg-success mt-1" data-i18n="dashboard.online">Online</div>
                        <div class="mt-3">
                            <select id="app-selector" class="form-select form-select-sm mb-2">
                                <option value="whatsapp">WhatsApp</option>
                                <option value="telegram">Telegram</option>
                            </select>
                            
                            <!-- WhatsApp QR Code Button -->
                            <div id="whatsapp-auth-container">
                                <button id="show-qr-scanner" class="btn btn-outline-light w-100 btn-sm mb-2" data-bs-toggle="modal" data-bs-target="#qrScannerModal">
                                    <i class="bi bi-qr-code-scan"></i> <span data-i18n="dashboard.qr_code">Scan WhatsApp QR Code</span>
                                </button>
                            </div>
                            
                            <!-- Telegram Token Input -->
                            <div id="telegram-auth-container" style="display: none;">
                                <div class="input-group input-group-sm mb-2">
                                    <input type="password" id="telegram-token" class="form-control" placeholder="Enter Telegram Bot Token">
                                    <button id="save-telegram-token" class="btn btn-outline-light" type="button">
                                        <i class="bi bi-save"></i>
                                    </button>
                                </div>
                                <div id="telegram-status" class="small text-muted">
                                    <i class="bi bi-info-circle"></i> Get token from @BotFather
                                </div>
                            </div>
                        </div>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                                <i class="bi bi-speedometer2 me-2"></i><span data-i18n="nav.dashboard">Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#settings" data-bs-toggle="tab">
                                <i class="bi bi-gear me-2"></i><span data-i18n="nav.settings">Settings</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#triggers" data-bs-toggle="tab">
                                <i class="bi bi-lightning me-2"></i><span data-i18n="nav.triggers">Triggers</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#chats" data-bs-toggle="tab">
                                <i class="bi bi-chat-dots me-2"></i><span data-i18n="nav.chats">Chats</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#kb" data-bs-toggle="tab">
                                <i class="bi bi-database me-2"></i><span data-i18n="nav.knowledge_base">Knowledge Base</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#commands" data-bs-toggle="tab">
                                <i class="bi bi-terminal me-2"></i><span data-i18n="nav.commands">Command History</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#system" data-bs-toggle="tab">
                                <i class="bi bi-cpu me-2"></i><span data-i18n="nav.system">System</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#platforms" data-bs-toggle="tab">
                                <i class="bi bi-share me-2"></i><span data-i18n="nav.platforms">Platforms</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#workflows" data-bs-toggle="tab">
                                <i class="bi bi-diagram-3 me-2"></i><span data-i18n="nav.workflows">Workflows</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-1 mb-2 border-bottom">
                    <h1 class="h2" data-i18n="dashboard.title">WhatsXENO Management Console</h1>
                    <div class="btn-toolbar mb-1 mb-md-0">
                        <div class="btn-group me-2">
                            <button id="login-btn" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-shield-lock"></i> <span data-i18n="button.admin_login">Admin Login</span>
                            </button>
                            <button id="logout-btn" class="btn btn-sm btn-outline-danger" style="display: none;">
                                <i class="bi bi-shield-lock-fill"></i> <span data-i18n="button.logout_admin">Logout Admin</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold" data-i18n="dashboard.system_health">System Health</h6>
                                        <div class="dropdown no-arrow">
                                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                                                <div class="dropdown-header" data-i18n="common.actions">Actions:</div>
                                                <a class="dropdown-item" href="#" id="refresh-dashboard" data-i18n="button.refresh">Refresh</a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-area">
                                            <canvas id="memoryChart"></canvas>
                                        </div>
                                        <div class="mt-4 small">
                                            <div id="system-stats-container" class="row text-center">
                                                <div class="col-3">
                                                    <span class="me-2" data-i18n="dashboard.uptime">Uptime:</span>
                                                    <span id="uptime-value" class="fw-bold">-</span>
                                                </div>
                                                <div class="col-3">
                                                    <span class="me-2" data-i18n="dashboard.heap_used">Heap Used:</span>
                                                    <span id="heap-used" class="fw-bold">-</span>
                                                </div>
                                                <div class="col-3">
                                                    <span class="me-2" data-i18n="dashboard.cpu">CPU:</span>
                                                    <span id="cpu-usage" class="fw-bold">-</span>
                                                </div>
                                                <div class="col-3">
                                                    <span class="me-2" data-i18n="dashboard.platform">Platform:</span>
                                                    <span id="platform-info" class="fw-bold">-</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-xl-3 mb-4">
                                <div class="card shadow border-left-primary h-100 py-2">
                                    <div class="card-body">
                                        <div class="row no-gutters align-items-center">
                                            <div class="col mr-2">
                                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1" data-i18n="dashboard.bot_status">Bot Status</div>
                                                <div id="bot-status" class="h5 mb-0 font-weight-bold" data-i18n="dashboard.online">Online</div>
                                            </div>
                                            <div class="col-auto">
                                                <i class="bi bi-robot fa-2x text-gray-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xl-3 mb-4">
                                <div class="card shadow border-left-success h-100 py-2">
                                    <div class="card-body">
                                        <div class="row no-gutters align-items-center">
                                            <div class="col mr-2">
                                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1" data-i18n="dashboard.current_model">Current Model</div>
                                                <div id="current-model" class="h5 mb-0 font-weight-bold">-</div>
                                            </div>
                                            <div class="col-auto">
                                                <i class="bi bi-cpu fa-2x text-gray-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xl-3 mb-4">
                                <div class="card shadow border-left-info h-100 py-2">
                                    <div class="card-body">
                                        <div class="row no-gutters align-items-center">
                                            <div class="col mr-2">
                                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1" data-i18n="dashboard.rag_status">RAG Status</div>
                                                <div id="rag-status" class="h5 mb-0 font-weight-bold">-</div>
                                            </div>
                                            <div class="col-auto">
                                                <i class="bi bi-database-check fa-2x text-gray-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 col-xl-3 mb-4">
                                <div class="card shadow border-left-warning h-100 py-2">
                                    <div class="card-body">
                                        <div class="row no-gutters align-items-center">
                                            <div class="col mr-2">
                                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1" data-i18n="dashboard.provider">Provider</div>
                                                <div id="provider" class="h5 mb-0 font-weight-bold">-</div>
                                            </div>
                                            <div class="col-auto">
                                                <i class="bi bi-cloud fa-2x text-gray-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Chats Card -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card shadow h-100">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold" data-i18n="dashboard.recent_chats">Recent Chats</h6>
                                        <button id="refresh-recent-chats" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-arrow-clockwise"></i>
                                        </button>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th data-i18n="chat.chat_id">Chat ID</th>
                                                        <th data-i18n="chat.last_message">Last Message</th>
                                                        <th data-i18n="chat.messages">Messages</th>
                                                        <th data-i18n="chat.ai">AI</th>
                                                        <th data-i18n="common.actions">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="recent-chats-body">
                                                    <tr>
                                                        <td colspan="5" class="text-center py-4">
                                                            <div class="spinner-border spinner-border-sm" role="status">
                                                                <span class="visually-hidden">Loading...</span>
                                                            </div>
                                                            <span class="ms-2" data-i18n="chat.loading_recent">Loading recent chats...</span>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="card-footer bg-transparent border-top-0 text-end">
                                            <a href="#chats" class="btn btn-sm btn-outline-primary" data-bs-toggle="tab" data-bs-target="#chats">
                                                <span data-i18n="chat.view_all">View All Chats</span> <i class="bi bi-arrow-right ms-1"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div class="tab-pane fade" id="settings">
                        <div class="alert alert-warning non-admin-only">
                            <i class="bi bi-exclamation-triangle"></i> <span data-i18n="settings.limited_access">You are in limited access mode. Log in as admin to access all features.</span>
                        </div>
                        <h4 data-i18n="settings.bot_settings">Bot Settings</h4>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <span data-i18n="settings.changes_immediate">Changes will be applied immediately.</span>
                        </div>
                        <form id="settings-form" class="mt-3">
                            <div class="mb-4 border p-3 rounded">
                                <h5 class="mb-3" data-i18n="settings.config_profiles">Configuration Profiles</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="profile-select" class="form-label" data-i18n="settings.current_profile">Current Profile</label>
                                        <select id="profile-select" class="form-select">
                                            <!-- Profiles will be loaded here -->
                                        </select>
                                        <div class="form-text" data-i18n="settings.select_profile_help">Select a profile to load its settings</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="new-profile-name" class="form-label" data-i18n="settings.new_profile_name">New Profile Name</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="new-profile-name" data-i18n-placeholder="settings.enter_profile_name" placeholder="Enter profile name">
                                            <button class="btn btn-outline-primary" type="button" id="save-profile-btn" data-i18n="settings.save_as">Save As</button>
                                        </div>
                                        <div class="form-text" data-i18n="settings.save_profile_help">Save current settings as a new profile</div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-outline-danger btn-sm" id="delete-profile-btn">
                                        <i class="bi bi-trash"></i> <span data-i18n="settings.delete_profile">Delete Profile</span>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="rag-enabled">
                                <label class="form-check-label" for="rag-enabled" data-i18n="settings.enable_rag">Enable RAG</label>
                            </div>
                            
                            <div class="mb-3">
                                <label for="system-prompt" class="form-label" data-i18n="settings.system_prompt">System Prompt</label>
                                <textarea class="form-control" id="system-prompt" rows="5"></textarea>
                            </div>
                            
                            <!-- Advanced Configuration Section -->
                            <div id="advanced-config" class="mt-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h5 data-i18n="settings.advanced_config">Advanced Configuration</h5>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="toggle-advanced">
                                        <i class="bi bi-chevron-down"></i> <span data-i18n="settings.show_advanced">Show Advanced</span>
                                    </button>
                                </div>
                                
                                <div id="advanced-options" style="display: none;">
                                    <div class="mb-3">
                                        <label for="provider" class="form-label">LLM Provider</label>
                                        <select id="provider-select" class="form-select">
                                            <option value="openai">OpenAI</option>
                                            <option value="openrouter">OpenRouter</option>
                                            <option value="ollama">Ollama</option>
                                            <option value="mcp">MCP</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="model" class="form-label">Model</label>
                                        <input type="text" class="form-control" id="model-input">
                                    </div>
                                    
                                    <div id="api-keys-section" class="mb-4 border p-3 rounded">
                                        <h5 class="mb-3">API Keys</h5>
                                        <div class="mb-3" id="openai-key-group">
                                            <label for="openai-api-key" class="form-label">OpenAI API Key</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control api-key-input" id="openai-api-key" placeholder="sk-..."> 
                                                <button class="btn btn-outline-secondary toggle-visibility" type="button">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3" id="openrouter-key-group">
                                            <label for="openrouter-api-key" class="form-label">OpenRouter API Key</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control api-key-input" id="openrouter-api-key" placeholder="sk-..."> 
                                                <button class="btn btn-outline-secondary toggle-visibility" type="button">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="form-text text-muted">
                                            <i class="bi bi-shield-lock"></i> API keys are stored securely in environment variables on the server.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary" data-i18n="settings.save">Save Settings</button>
                        </div>
                        </form>
                    </div>

                    <!-- Chats Tab -->
                    <div class="tab-pane fade" id="chats">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="mb-0" data-i18n="chat.title">Chat History</h4>
                            <div>
                                <button id="refresh-chats" class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-arrow-clockwise"></i> <span data-i18n="button.refresh">Refresh</span>
                                </button>
                                <button id="clear-all-chats" class="btn btn-outline-danger btn-sm ms-2">
                                    <i class="bi bi-trash"></i> <span data-i18n="chat.clear_all">Clear All</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="card shadow-sm mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center py-2">
                                <div class="d-flex align-items-center">
                                    <span class="me-2" data-i18n="chat.sort_by">Sort by:</span>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="toggleChatSort()">
                                        <i id="sort-chats" class="bi bi-sort-down"></i>
                                        <span id="sort-text" data-i18n="chat.newest_first">Newest First</span>
                                    </button>
                                </div>
                                <div id="chats-count" class="text-muted small"></div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th data-i18n="chat.chat_id">Chat ID</th>
                                                <th data-i18n="chat.preview">Preview</th>
                                                <th data-i18n="chat.last_active">Last Active</th>
                                                <th class="text-center" data-i18n="chat.messages">Messages</th>
                                                <th class="text-end" data-i18n="common.actions">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="chats-table-body">
                                            <tr>
                                                <td colspan="5" class="text-center py-4">
                                                    <div class="spinner-border text-secondary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                    <p class="mt-2 mb-0" data-i18n="chat.loading">Loading chat history...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent border-top-0 py-2">
                                <div id="chats-pagination">
                                    <!-- Pagination controls will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="kb">
                        <h4 data-i18n="kb.title">Knowledge Base Documents</h4>
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <button id="refresh-kb" class="btn btn-outline-secondary btn-sm">
                                    <i class="bi bi-arrow-clockwise"></i> <span data-i18n="button.refresh">Refresh</span>
                                </button>
                            </div>
                            <div data-admin-only>
                                <form id="upload-form" class="d-inline">
                                    <input type="file" id="kb-file-input" class="form-control form-control-sm d-none">
                                    <label for="kb-file-input" class="btn btn-primary btn-sm">
                                        <i class="bi bi-upload"></i> <span data-i18n="button.upload_document">Upload Document</span>
                                    </label>
                                </form>
                            </div>
                        </div>
                        <div id="kb-documents" class="mt-3">
                            <!-- Knowledge base documents will be rendered here -->
                            <div class="text-center">
                                <div class="spinner-border" role="status"></div>
                                <p data-i18n="button.loading_documents">Loading documents...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Command History Tab -->
                    <div class="tab-pane fade" id="commands">
                        <h4 data-i18n="commands.title">Command History</h4>
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold" data-i18n="commands.recent">Recent Commands</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th data-i18n="commands.time">Time</th>
                                                <th data-i18n="commands.sender">Sender</th>
                                                <th data-i18n="commands.command">Command</th>
                                                <th data-i18n="commands.arguments">Arguments</th>
                                            </tr>
                                        </thead>
                                        <tbody id="command-history-body">
                                            <!-- Command history will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Triggers Tab -->
                    <div class="tab-pane fade" id="triggers" data-admin-only>
                        <h4 class="mb-3" data-i18n="triggers.title">Bot Triggers</h4>
                        <p data-i18n="triggers.description">Configure words or phrases that will trigger the bot to respond in group chats.</p>
                        
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold" data-i18n="triggers.group_chat">Group Chat Triggers</h6>
                            </div>
                            <div class="card-body">
                                <p data-i18n="triggers.group_help">These words will activate the bot in group chats when mentioned anywhere in a message.</p>
                                
                                <div class="mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <input type="text" class="form-control" id="newGroupTrigger" data-i18n-placeholder="triggers.add_trigger" placeholder="Add new trigger word...">
                                        <button class="btn btn-primary ms-2" id="addGroupTrigger" data-i18n="common.add">Add</button>
                                    </div>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle me-2"></i> <span data-i18n="triggers.case_insensitive_help">Triggers are case-insensitive. The bot will respond if any of these words appear in a message.</span>
                                    </div>
                                </div>
                                
                                <div class="list-group" id="groupTriggersList">
                                    <!-- Triggers will be populated here by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="m-0 font-weight-bold" data-i18n="triggers.custom">Custom Triggers</h6>
                            </div>
                            <div class="card-body">
                                <p data-i18n="triggers.custom_help">Add custom triggers for specific use cases.</p>
                                
                                <div class="mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <input type="text" class="form-control" id="newCustomTrigger" data-i18n-placeholder="triggers.add_custom" placeholder="Add new custom trigger...">
                                        <button class="btn btn-primary ms-2" id="addCustomTrigger" data-i18n="common.add">Add</button>
                                    </div>
                                </div>
                                
                                <div class="list-group" id="customTriggersList">
                                    <!-- Custom triggers will be populated here by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button class="btn btn-success" id="saveTriggers" data-i18n="triggers.save">Save Triggers</button>
                        </div>
                    </div>
                    
                    <!-- System Tab -->
                    <div class="tab-pane fade" id="system" data-admin-only>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="mb-0" data-i18n="system.title">System Information</h4>
                            <button id="restart-server" class="btn btn-warning" data-admin-only>
                                <i class="bi bi-arrow-clockwise me-1"></i> <span data-i18n="system.restart_server">Restart Server</span>
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold" data-i18n="system.environment">Environment</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody id="system-env-body">
                                                    <tr>
                                                        <td data-i18n="system.nodejs_version">Node.js Version</td>
                                                        <td id="node-version">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.platform">Platform</td>
                                                        <td id="system-platform">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.cpu">CPU</td>
                                                        <td id="cpu-model">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.uptime">Uptime</td>
                                                        <td id="system-uptime">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.show_branding">Show Branding</td>
                                                        <td>
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input" type="checkbox" id="toggle-branding" checked>
                                                                <label class="form-check-label" for="toggle-branding" data-i18n="system.show_whatsxeno_logo">Show WhatsXENO Logo & Favicon</label>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold" data-i18n="system.memory_usage">Memory Usage</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody id="memory-usage-body">
                                                    <tr>
                                                        <td data-i18n="system.rss">RSS</td>
                                                        <td id="memory-rss">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.heap_total">Heap Total</td>
                                                        <td id="memory-heap-total">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.heap_used">Heap Used</td>
                                                        <td id="memory-heap-used">-</td>
                                                    </tr>
                                                    <tr>
                                                        <td data-i18n="system.external">External</td>
                                                        <td id="memory-external">-</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- GPU Information -->
                            <div class="col-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold" data-i18n="system.gpu_info">GPU Information</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="gpu-loading" class="text-center">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <span class="ms-2" data-i18n="system.loading_gpu">Loading GPU information...</span>
                                        </div>
                                        <div id="gpu-info" style="display: none;">
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <tbody id="gpu-info-body">
                                                        <tr>
                                                            <td data-i18n="system.model">Model</td>
                                                            <td id="gpu-model">-</td>
                                                        </tr>
                                                        <tr>
                                                            <td data-i18n="system.vendor">Vendor</td>
                                                            <td id="gpu-vendor">-</td>
                                                        </tr>
                                                        <tr>
                                                            <td data-i18n="system.vram">VRAM</td>
                                                            <td id="gpu-vram">-</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Driver</td>
                                                            <td id="gpu-driver">-</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Usage</td>
                                                            <td>
                                                                <div class="progress">
                                                                    <div id="gpu-usage-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                                                         role="progressbar" style="width: 0%" 
                                                                         aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                                                </div>
                                                                <span id="gpu-usage-text">0%</span>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="gpu-not-available" class="text-muted text-center" style="display: none;">
                                            <i class="bi bi-gpu-card"></i> No GPU information available
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Platforms Tab -->
                    <div class="tab-pane fade" id="platforms" data-admin-only>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="mb-0" data-i18n="platforms.title">Platform Management</h4>
                            <button class="btn btn-outline-primary" id="refresh-platforms-btn">
                                <i class="bi bi-arrow-clockwise me-1"></i> <span data-i18n="platforms.refresh">Refresh Status</span>
                            </button>
                        </div>
                        
                        <div class="row">
                            <!-- WhatsApp Platform -->
                            <div class="col-md-6 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold d-flex align-items-center">
                                            <i class="bi bi-whatsapp text-success me-2"></i>
                                            <span data-i18n="platforms.whatsapp">WhatsApp</span>
                                        </h6>
                                        <div class="d-flex align-items-center gap-2">
                                            <span id="whatsapp-status" class="badge bg-secondary" data-i18n="platforms.status.not_connected">Not connected</span>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="whatsapp-enabled" checked>
                                                <label class="form-check-label visually-hidden" for="whatsapp-enabled">Enable WhatsApp</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label" data-i18n="platforms.connection_method">Connection Method:</label>
                                            <p class="text-muted small mb-2" data-i18n="platforms.whatsapp_method">WhatsApp Web (QR Code)</p>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" id="whatsapp-connect-btn" data-i18n="platforms.connect">Connect</button>
                                            <button class="btn btn-outline-danger" id="whatsapp-disconnect-btn" style="display: none;" data-i18n="platforms.disconnect">Disconnect</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Telegram Platform -->
                            <div class="col-md-6 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold d-flex align-items-center">
                                            <i class="bi bi-telegram text-primary me-2"></i>
                                            <span data-i18n="platforms.telegram">Telegram</span>
                                        </h6>
                                        <div class="d-flex align-items-center gap-2">
                                            <span id="telegram-status" class="badge bg-secondary" data-i18n="platforms.status.not_connected">Not connected</span>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="telegram-enabled" checked>
                                                <label class="form-check-label visually-hidden" for="telegram-enabled">Enable Telegram</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label" data-i18n="platforms.connection_method">Connection Method:</label>
                                            <p class="text-muted small mb-2" data-i18n="platforms.telegram_method">Bot API Token</p>
                                        </div>
                                        <div class="mb-3">
                                            <label for="telegram-token" class="form-label" data-i18n="platforms.bot_token">Bot Token:</label>
                                            <div class="input-group">
                                                <input type="password" class="form-control" id="telegram-token" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                                                <button class="btn btn-outline-secondary" type="button" id="telegram-token-toggle">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" id="telegram-connect-btn" data-i18n="platforms.connect">Connect</button>
                                            <button class="btn btn-outline-danger" id="telegram-disconnect-btn" style="display: none;" data-i18n="platforms.disconnect">Disconnect</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Facebook Messenger Platform -->
                            <div class="col-md-6 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold d-flex align-items-center">
                                            <i class="bi bi-messenger text-primary me-2"></i>
                                            <span data-i18n="platforms.facebook">Facebook Messenger</span>
                                        </h6>
                                        <div class="d-flex align-items-center gap-2">
                                            <span id="facebook-status" class="badge bg-secondary" data-i18n="platforms.status.not_connected">Not connected</span>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="facebook-enabled" checked>
                                                <label class="form-check-label visually-hidden" for="facebook-enabled">Enable Facebook</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label" data-i18n="platforms.connection_method">Connection Method:</label>
                                            <select class="form-select" id="facebook-method">
                                                <option value="official" data-i18n="platforms.facebook_official">Official API (Recommended)</option>
                                                <option value="easy" data-i18n="platforms.facebook_easy">Easy Setup (Login)</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Official API Method -->
                                        <div id="facebook-official-config" class="method-config">
                                            <div class="mb-3">
                                                <label for="facebook-page-token" class="form-label" data-i18n="platforms.page_access_token">Page Access Token:</label>
                                                <input type="password" class="form-control" id="facebook-page-token" placeholder="EAAxxxxxxxxxxxxx">
                                            </div>
                                            <div class="mb-3">
                                                <label for="facebook-verify-token" class="form-label" data-i18n="platforms.verify_token">Verify Token:</label>
                                                <input type="text" class="form-control" id="facebook-verify-token" placeholder="your_verify_token">
                                            </div>
                                            <div class="mb-3">
                                                <label for="facebook-app-secret" class="form-label" data-i18n="platforms.app_secret">App Secret:</label>
                                                <input type="password" class="form-control" id="facebook-app-secret" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                            </div>
                                        </div>
                                        
                                        <!-- Easy Setup Method -->
                                        <div id="facebook-easy-config" class="method-config" style="display: none;">
                                            <div class="mb-3">
                                                <label class="form-label" data-i18n="platforms.auth_method">Authentication Method:</label>
                                                <select class="form-select" id="facebook-auth-method" onchange="handleFacebookAuthMethodChange()">
                                                    <option value="app_state" data-i18n="platforms.app_state">App State (Recommended)</option>
                                                    <option value="login" data-i18n="platforms.login_credentials">Login Credentials</option>
                                                </select>
                                            </div>
                                            
                                            <!-- App State Authentication -->
                                            <div id="facebook-app-state-auth" class="auth-method-config">
                                                <div class="mb-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <label for="facebook-app-state" class="form-label mb-0" data-i18n="platforms.app_state">App State:</label>
                                                        <div class="btn-group btn-group-sm" role="group">
                                                            <button type="button" class="btn btn-outline-success" id="facebook-template-btn" data-i18n="platforms.facebook_template_help" title="Fill Template">
                                                                <i class="bi bi-clipboard"></i> <span data-i18n="platforms.facebook_template">Template</span>
                                                            </button>
                                                            <button type="button" class="btn btn-outline-primary" id="facebook-validate-btn" title="Validate App State">
                                                                <i class="bi bi-check-circle"></i> Validate
                                                            </button>
                                                            <button type="button" class="btn btn-outline-secondary" id="facebook-format-btn" title="Format JSON">
                                                                <i class="bi bi-code"></i> Format
                                                            </button>
                                                            <button type="button" class="btn btn-outline-info" id="facebook-help-btn" title="How to Extract">
                                                                <i class="bi bi-question-circle"></i> Help
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="position-relative">
                                                        <textarea class="form-control font-monospace" id="facebook-app-state" rows="8" 
                                                                  placeholder='Copy your Facebook cookie values and paste them below:

[{"key":"c_user","value":"PASTE_YOUR_C_USER_VALUE_HERE","domain":".facebook.com"},{"key":"xs","value":"PASTE_YOUR_XS_VALUE_HERE","domain":".facebook.com"},{"key":"datr","value":"PASTE_YOUR_DATR_VALUE_HERE","domain":".facebook.com"},{"key":"sb","value":"PASTE_YOUR_SB_VALUE_HERE","domain":".facebook.com"}]

Instructions:
1. Login to facebook.com in your browser
2. Open Developer Tools (F12)
3. Go to Application/Storage → Cookies → facebook.com
4. Find the 4 cookies above and copy their VALUES
5. Replace the PASTE_YOUR_..._HERE text with your actual values'
                                                                  style="resize: vertical; min-height: 160px;"></textarea>
                                                        <div id="facebook-app-state-status" class="position-absolute top-0 end-0 me-2 mt-2" style="z-index: 5;"></div>
                                                    </div>
                                                    <div class="form-text mt-2">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        <span data-i18n="platforms.facebook_app_state_help">Extract app state cookies from browser after logging into Facebook</span>
                                                        <br>
                                                        <small class="text-muted">Required cookies: c_user, xs, datr, sb</small>
                                                    </div>
                                                </div>
                                                
                                                <!-- Validation Results -->
                                                <div id="facebook-validation-result" class="mb-3" style="display: none;"></div>
                                                
                                                <div class="alert alert-info small">
                                                    <i class="bi bi-shield-check me-1"></i>
                                                    <strong>Benefits:</strong> <span data-i18n="platforms.facebook_app_state_info">App State method is more stable and avoids login challenges</span>
                                                    <br>
                                                    <small class="text-muted mt-1 d-block">
                                                        • No 2FA issues • Bypasses bot detection • Longer session life • More reliable connection
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <!-- Login Credentials Authentication -->
                                            <div id="facebook-login-auth" class="auth-method-config" style="display: none;">
                                                <div class="mb-3">
                                                    <label for="facebook-email" class="form-label" data-i18n="platforms.email">Email:</label>
                                                    <input type="email" class="form-control" id="facebook-email" placeholder="your-bot-account@example.com">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="facebook-password" class="form-label" data-i18n="platforms.password">Password:</label>
                                                    <input type="password" class="form-control" id="facebook-password" placeholder="password">
                                                </div>
                                                <div class="alert alert-warning small">
                                                    <i class="bi bi-exclamation-triangle me-1"></i>
                                                    <span data-i18n="platforms.facebook_warning">Use a dedicated bot account. Avoid 2FA.</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" id="facebook-connect-btn" data-i18n="platforms.connect">Connect</button>
                                            <button class="btn btn-outline-danger" id="facebook-disconnect-btn" style="display: none;" data-i18n="platforms.disconnect">Disconnect</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Instagram Platform -->
                            <div class="col-md-6 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold d-flex align-items-center">
                                            <i class="bi bi-instagram text-danger me-2"></i>
                                            <span data-i18n="platforms.instagram">Instagram</span>
                                        </h6>
                                        <div class="d-flex align-items-center gap-2">
                                            <span id="instagram-status" class="badge bg-secondary" data-i18n="platforms.status.not_connected">Not connected</span>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="instagram-enabled" checked>
                                                <label class="form-check-label visually-hidden" for="instagram-enabled">Enable Instagram</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label" data-i18n="platforms.connection_method">Connection Method:</label>
                                            <select class="form-select" id="instagram-method">
                                                <option value="official" data-i18n="platforms.instagram_official">Official API (Business)</option>
                                                <option value="private" data-i18n="platforms.instagram_private">Private API (Unofficial)</option>
                                                <option value="web" data-i18n="platforms.instagram_web">Web Automation</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Official API Method -->
                                        <div id="instagram-official-config" class="method-config">
                                            <div class="mb-3">
                                                <label for="instagram-access-token" class="form-label" data-i18n="platforms.access_token">Access Token:</label>
                                                <input type="password" class="form-control" id="instagram-access-token" placeholder="IGQVJxxxxxxxxxxxxx">
                                            </div>
                                            <div class="mb-3">
                                                <label for="instagram-verify-token" class="form-label" data-i18n="platforms.verify_token">Verify Token:</label>
                                                <input type="text" class="form-control" id="instagram-verify-token" placeholder="your_verify_token">
                                            </div>
                                            <div class="mb-3">
                                                <label for="instagram-app-secret" class="form-label" data-i18n="platforms.app_secret">App Secret:</label>
                                                <input type="password" class="form-control" id="instagram-app-secret" placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                            </div>
                                        </div>
                                        
                                        <!-- Private API Method -->
                                        <div id="instagram-private-config" class="method-config" style="display: none;">
                                            <!-- Session ID Only -->
                                            <div class="mb-3">
                                                <label for="instagram-session-id" class="form-label" data-i18n="platforms.session_id">Session ID:</label>
                                                <div class="input-group mb-2">
                                                    <textarea class="form-control" id="instagram-session-id" rows="3" placeholder="sessionid=12345678%3A..." required></textarea>
                                                    <button class="btn btn-outline-primary" type="button" id="extract-session-btn" title="Extract Session ID from Browser">
                                                        <i class="bi bi-download"></i> Extract
                                                    </button>
                                                </div>
                                                <div class="form-text small">
                                                    <i class="bi bi-info-circle me-1"></i>
                                                    <span data-i18n="platforms.session_help">Extract sessionid cookie from browser after logging into Instagram</span>
                                                </div>
                                                <div class="d-grid gap-2 mt-2">
                                                    <button class="btn btn-sm btn-outline-info" id="session-extractor-help-btn">
                                                        <i class="bi bi-question-circle me-1"></i>
                                                        <span data-i18n="platforms.session_extractor_help">How to Extract Session ID</span>
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="alert alert-success small">
                                                <i class="bi bi-shield-check me-1"></i>
                                                <span data-i18n="platforms.instagram_session_only">Session ID is the only supported authentication method for stability and security.</span>
                                            </div>
                                            <div class="alert alert-warning small">
                                                <i class="bi bi-exclamation-triangle me-1"></i>
                                                <span data-i18n="platforms.instagram_warning">Use a dedicated bot account. Risk of restrictions.</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Web Automation Method -->
                                        <div id="instagram-web-config" class="method-config" style="display: none;">
                                            <div class="mb-3">
                                                <label for="instagram-web-username" class="form-label" data-i18n="platforms.username">Username:</label>
                                                <input type="text" class="form-control" id="instagram-web-username" placeholder="your_bot_account">
                                            </div>
                                            <div class="mb-3">
                                                <label for="instagram-web-password" class="form-label" data-i18n="platforms.password">Password:</label>
                                                <input type="password" class="form-control" id="instagram-web-password" placeholder="password">
                                            </div>
                                            <div class="alert alert-info small">
                                                <i class="bi bi-info-circle me-1"></i>
                                                <span data-i18n="platforms.instagram_web_info">Browser automation fallback method.</span>
                                            </div>
                                        </div>
                                        
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" id="instagram-connect-btn" data-i18n="platforms.connect">Connect</button>
                                            <button class="btn btn-outline-danger" id="instagram-disconnect-btn" style="display: none;" data-i18n="platforms.disconnect">Disconnect</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Platform Status Summary -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card shadow">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold" data-i18n="platforms.status_summary">Platform Status Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th data-i18n="platforms.platform">Platform</th>
                                                        <th data-i18n="platforms.status">Status</th>
                                                        <th data-i18n="platforms.method">Method</th>
                                                        <th data-i18n="platforms.last_activity">Last Activity</th>
                                                        <th data-i18n="platforms.actions">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="platforms-status-table">
                                                    <!-- Platform status rows will be populated here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Workflows Tab -->
                    <div class="tab-pane fade" id="workflows" data-admin-only>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="mb-0" data-i18n="workflow.title">Workflow Management</h4>
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-secondary" id="upload-workflow-btn">
                                    <i class="bi bi-upload me-1"></i> <span data-i18n="workflow.upload">Upload Workflow</span>
                                </button>
                                <a href="/red/" target="_blank" class="btn btn-primary" id="workflow-editor-btn">
                                    <i class="bi bi-pencil-square me-1"></i> <span data-i18n="workflow.open_editor">Open Workflow Editor</span>
                                </a>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-4">
                                <div class="card shadow">
                                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 font-weight-bold" data-i18n="workflow.available">Available Workflows</h6>
                                        <button id="refresh-workflows" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-arrow-clockwise"></i> <span data-i18n="workflow.refresh">Refresh</span>
                                        </button>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th data-i18n="workflow.name">Name</th>
                                                        <th data-i18n="workflow.description">Description</th>
                                                        <th data-i18n="workflow.status">Status</th>
                                                        <th data-i18n="workflow.actions">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="workflows-table-body">
                                                    <!-- Workflow items will be populated here -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div id="no-workflows" class="text-center p-4" style="display: none;">
                                            <i class="bi bi-exclamation-circle text-muted mb-3" style="font-size: 2rem;"></i>
                                            <p class="text-muted" data-i18n="workflow.no_workflows">No workflows available. Create workflows in the Node-RED editor.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Workflows will be displayed in the table above -->
                        
                        <!-- Hidden file input for workflow upload -->
                        <input type="file" id="workflow-file-input" accept=".json" style="display: none; position: absolute; visibility: hidden;" multiple>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div class="modal fade" id="adminLoginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="admin.modal_title">Admin Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="admin-login-form">
                        <div class="mb-3">
                            <label for="admin-password" class="form-label" data-i18n="admin.password_label">Admin Password</label>
                            <input type="password" class="form-control" id="admin-password" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="common.cancel">Cancel</button>
                    <button type="button" id="submit-login" class="btn btn-primary" data-i18n="admin.login_button">Login</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Scanner Modal -->
    <div class="modal fade" id="qrScannerModal" tabindex="-1" aria-labelledby="qrScannerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="qrScannerModalLabel" data-i18n="qr.modal_title">Scan WhatsApp QR Code</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="qr-code-container" class="mb-3">
                        <p data-i18n="qr.loading">Loading QR code...</p>
                    </div>
                    <div id="qr-status" class="alert alert-info">
                        <i class="bi bi-qr-code-scan"></i> <span data-i18n="qr.scan_instruction">Scan the QR code with your WhatsApp mobile app</span>
                    </div>
                    <button id="refresh-qr" class="btn btn-primary">
                        <i class="bi bi-arrow-clockwise"></i> <span data-i18n="button.refresh_qr">Refresh QR Code</span>
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="button.close">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Chat Messages with Manual Intervention -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content h-100">
                <div class="modal-header bg-light">
                    <div class="d-flex align-items-center w-100">
                        <h5 class="modal-title me-auto" id="chatModalTitle" data-i18n="chat.chat_details">Chat Details</h5>
                        
                        <!-- Chat Controls -->
                        <div class="d-flex align-items-center gap-3 me-3">
                            <!-- AI Toggle -->
                            <div class="d-flex align-items-center">
                                <label class="form-label small me-2 mb-0" data-i18n="chat.ai_toggle_label">AI:</label>
                                <div class="form-check form-switch mb-0">
                                    <input class="form-check-input" 
                                           type="checkbox" 
                                           id="chatModalAiToggle"
                                           checked>
                                    <label class="form-check-label small text-muted" 
                                           id="chatModalAiToggleLabel"
                                           for="chatModalAiToggle"
                                           data-i18n="chat.ai_toggle_on">
                                        On
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Refresh Button -->
                            <button type="button" 
                                    class="btn btn-outline-secondary btn-sm" 
                                    id="chatModalRefreshBtn"
                                    data-i18n-title="chat.refresh_chat"
                                    title="Refresh Chat">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                        
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body p-0 d-flex flex-column" style="height: 70vh;">
                    <!-- Chat Messages Area -->
                    <div id="chat-messages" class="flex-grow-1 p-3" style="overflow-y: auto; min-height: 400px;">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <!-- Manual Message Input Area -->
                    <div class="border-top p-3 bg-light">
                        <div class="row g-2">
                            <div class="col">
                                <div class="input-group">
                                    <input type="text" 
                                           id="manual-message-input" 
                                           class="form-control" 
                                           data-i18n-placeholder="chat.manual_message_placeholder"
                                           placeholder="Type a message to send manually..." 
                                           onkeypress="if(event.key==='Enter') sendManualMessage()">
                                    <button class="btn btn-primary" 
                                            id="send-manual-message" 
                                            type="button" 
                                            onclick="sendManualMessage()">
                                        <i class="bi bi-send"></i> <span data-i18n="chat.send">Send</span>
                                    </button>
                                </div>
                                <div class="form-text small mt-1">
                                    <i class="bi bi-info-circle"></i> 
                                    <span data-i18n="chat.manual_message_help">Send messages manually through the bot. AI response depends on the toggle in the chat list.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i> <span data-i18n="button.close">Close</span>
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="exportChatBtn">
                        <i class="bi bi-download me-1"></i> <span data-i18n="button.export">Export</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toastContainer" class="toast-container">
            <!-- Toasts will be added here dynamically -->
        </div>
    </div>

    <!-- JS Dependencies -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="/js/script.js"></script>
    <script src="/js/admin.js"></script>
    <script src="/js/branding.js"></script>
    <script src="/js/platforms.js"></script>
</body>
</html>
